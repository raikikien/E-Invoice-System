<!DOCTYPE html>
<html lang="en">

<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>


    <style>
        div.box {
            box-sizing: border-box;
            width: 80%;
            float: left;
        }
    </style>

</head>

<body>

    <nav class="navbar navbar-expand-md navbar-light bg-light">
        <a class="navbar-brand" class="btn btn-outline-secondary" href="/invoice_table.html">
            <h2>
                <div class="fs-2 mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-receipt" viewBox="0 0 16 16">
                        <path
                            d="M1.92.506a.5.5 0 0 1 .434.14L3 1.293l.646-.647a.5.5 0 0 1 .708 0L5 1.293l.646-.647a.5.5 0 0 1 .708 0L7 1.293l.646-.647a.5.5 0 0 1 .708 0L9 1.293l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .801.13l.5 1A.5.5 0 0 1 15 2v12a.5.5 0 0 1-.053.224l-.5 1a.5.5 0 0 1-.8.13L13 14.707l-.646.647a.5.5 0 0 1-.708 0L11 14.707l-.646.647a.5.5 0 0 1-.708 0L9 14.707l-.646.647a.5.5 0 0 1-.708 0L7 14.707l-.646.647a.5.5 0 0 1-.708 0L5 14.707l-.646.647a.5.5 0 0 1-.708 0L3 14.707l-.646.647a.5.5 0 0 1-.801-.13l-.5-1A.5.5 0 0 1 1 14V2a.5.5 0 0 1 .053-.224l.5-1a.5.5 0 0 1 .367-.27zm.217 1.338L2 2.118v11.764l.137.274.51-.51a.5.5 0 0 1 .707 0l.646.647.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.509.509.137-.274V2.118l-.137-.274-.51.51a.5.5 0 0 1-.707 0L12 1.707l-.646.647a.5.5 0 0 1-.708 0L10 1.707l-.646.647a.5.5 0 0 1-.708 0L8 1.707l-.646.647a.5.5 0 0 1-.708 0L6 1.707l-.646.647a.5.5 0 0 1-.708 0L4 1.707l-.646.647a.5.5 0 0 1-.708 0l-.509-.51z">
                        </path>
                        <path
                            d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm8-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z">
                        </path>
                    </svg>
                    E-invoice System
                </div>
            </h2>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse flex-grow-1 text-right" id="navbarNav">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a href="/invoice_new.html">
                        <button type="button" class="btn btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-file-earmark-plus-fill" viewBox="0 0 16 16">
                                <path
                                    d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0zM9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1zM8.5 7v1.5H10a.5.5 0 0 1 0 1H8.5V11a.5.5 0 0 1-1 0V9.5H6a.5.5 0 0 1 0-1h1.5V7a.5.5 0 0 1 1 0z">
                                </path>
                            </svg>
                            New Invoice
                        </button>
                    </a>
                </li>
                &nbsp;&nbsp;&nbsp;
                <li class="nav-item">
                    <a href="/user_table.html">
                        <button type="button" class="btn btn-info">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-people-fill" viewBox="0 0 16 16">
                                <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z">
                                </path>
                                <path fill-rule="evenodd"
                                    d="M5.216 14A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216z">
                                </path>
                                <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z"></path>
                            </svg>
                            User
                        </button>
                    </a>
                </li>
                &nbsp;&nbsp;&nbsp;
                <li class="nav-item">
                    <a href="/invoice_chart.html">
                        <button type="button" class="btn btn-success">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-bar-chart-line-fill" viewBox="0 0 16 16">
                                <path
                                    d="M11 2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v12h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3h1V7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7h1V2z">
                                </path>
                            </svg>
                            Chart
                        </button>
                    </a>
                </li>
                &nbsp;&nbsp;&nbsp;
                <li class="nav-item">
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary ">View By</button>
                        <button type="button" class="btn btn-secondary  dropdown-toggle dropdown-toggle-split"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="sr-only"></span>
                        </button>
                        <div class="dropdown-menu">
                            <a type="button" class="dropdown-item" onclick="getmonthly()">Monthly</a>
                            <a type="button" class="dropdown-item" onclick="getyearly()">Yearly</a>
                            <input value="Period" name="PeriodTime" type="button" class="dropdown-item"
                                value="Period" />
                            <script>
                                $(function () {
                                    $("input[name=PeriodTime]").click(function () {
                                        if ($(this).val() == "Period") {
                                            $("#TimeInput").toggle();
                                        }
                                    });
                                });
                            </script>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" onclick="getall()">All</a>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="box" id="TimeInput" style="display: none">
                        <span>From</span>
                        <input id="startPeriod" class="col-lg-3" type="text" placeholder="Start">
                        <span>To</span>
                        <input id="endPeriod" class="col-lg-3" type="text" placeholder="End">
                        <button onclick="getPeriod()" type="button">Submit</button>
                        &nbsp;
                    </div>
                </li>

            </ul>
            <ul class="navbar-nav">

                <li class="nav-item">
                    <a href="/index.html">
                        <button type="button" class="btn btn-outline-warning">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z">
                                </path>
                                <path fill-rule="evenodd"
                                    d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z">
                                </path>
                            </svg>
                            Logout
                        </button>
                    </a>
                </li>

            </ul>
        </div>
    </nav>
    <br>


    </div>

    <br />
    <table id="example" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th style="text-align:center;">ID
                </th>
                <th style="text-align:center;">Type Of Invoice
                </th>
                <th style="text-align:center;">Money
                </th>
                <th style="text-align:center;">VAT
                </th>
                <th style="text-align:center;">Charge Period
                </th>
                <th style="text-align:center;">Total Money
                </th>

                <th style="text-align:center;">Actions
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="id" style="text-align:center;"></td>
                <td id="typename" style="text-align:center;"></td>
                <td id="money" style="text-align:center;"></td>
                <td id="vat" style="text-align:center;"></td>
                <td id="chargeperiod" style="text-align:center;"></td>
                <td id="totalmoney" style="text-align:center;"></td>
                <td>
                    <div style="text-align:center;"> <button onclick="updateInvoice(this)" type="button"
                            class="update btn btn-outline-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-pencil-square" viewBox="0 0 16 16">
                                <path
                                    d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z">
                                </path>
                                <path fill-rule="evenodd"
                                    d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z">
                                </path>
                            </svg>
                        </button>
                        &nbsp;&nbsp;&nbsp;
                        <button onclick="DeleteInvoice(this)" type="button" class="update btn btn-outline-danger">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-x-square" viewBox="0 0 16 16">
                                <path
                                    d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z">
                                </path>
                                <path
                                    d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z">
                                </path>
                            </svg>
                        </button>
                    </div>
                </td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <th style="text-align:center;">ID
                </th>
                <th style="text-align:center;">Type Of Invoice
                </th>
                <th style="text-align:center;">Money
                </th>
                <th style="text-align:center;">VAT
                </th>
                <th style="text-align:center;">Charge Period
                </th>
                <th style="text-align:center;">Total Money
                </th>

                <th style="text-align:center;">Actions
                </th>
            </tr>
        </tfoot>
    </table>

    </div>
    <script type="text/javascript">
        $(document).ready(function () {

            console.log("hehe");
            function setDataOnRow(rowObject, v) {
                var id = v.id;
                var typename = v.typename;
                var money = v.money;
                var vat = v.vat;
                var chargeperiod = v.chargeperiod;
                var totalmoney = v.totalmoney;
                $(rowObject).find("#id").html(id);
                $(rowObject).find("#typename").html(typename);
                $(rowObject).find("#money").html(money);
                $(rowObject).find("#vat").html(vat);
                $(rowObject).find("#chargeperiod").html(chargeperiod);
                $(rowObject).find("#totalmoney").html(totalmoney);
                $(rowObject).find(".update").val(id);
            }
            $.ajax({
                url: "http://localhost:9191/invoices/all",
                method: "get",
                dataType: "json",
                success: function (data) {
                    console.log(data)
                    $('#example tbody').find("tr:gt(0)").remove(); //remove all old rows except first one
                    $.each(data, function (i, v) {
                        if (i == 0) {
                            //setting the data in first row itself
                            setDataOnRow($("#example tbody").find("tr").first(), v);
                            console.log(v)
                        } else {
                            //clonning the first row and setting data over it and then appending in tbody
                            var clonnedRow = $($("#example tbody").find("tr").first()).clone();
                            console.log(v)
                            setDataOnRow(clonnedRow, v);
                            $("#example tbody").append(clonnedRow);
                        }
                    })
                    $('#example').DataTable({
                        "bServerSide": false,
                    })
                }
            })

        }
        )
        function getmonthly() {
            console.log("hdsfhdshf")
            function setDataMonthly(rowObject, v) {
                var id = v.id;
                var typename = v.typename;
                var money = v.money;
                var vat = v.vat;
                var chargeperiod = v.chargeperiod;
                var totalmoney = v.totalmoney;
                $(rowObject).find("#id").html(id);
                $(rowObject).find("#typename").html(typename);
                $(rowObject).find("#money").html(money);
                $(rowObject).find("#vat").html(vat);
                $(rowObject).find("#chargeperiod").html(chargeperiod);
                $(rowObject).find("#totalmoney").html(totalmoney);
            }
            $.ajax({
                url: "http://localhost:9191/invoices/monthly",
                method: "get",
                dataType: "json",
                success: function (data) {
                    console.log(data)
                    $('#example tbody').find("tr:gt(0)").remove(); //remove all old rows except first one
                    $.each(data, function (i, v) {
                        if (i == 0) {
                            //setting the data in first row itself
                            setDataMonthly($("#example tbody").find("tr").first(), v);
                            console.log(v)
                        } else {
                            //clonning the first row and setting data over it and then appending in tbody
                            var clonnedRow = $($("#example tbody").find("tr").first()).clone();
                            console.log(v)
                            setDataMonthly(clonnedRow, v);
                            $("#example tbody").append(clonnedRow);
                        }
                    })
                }
            })
        }

        function getyearly() {
            console.log("hehe")
            function setDataYearly(rowObject, v) {
                var id = v.id;
                var typename = v.typename;
                var money = v.money;
                var vat = v.vat;
                var chargeperiod = v.chargeperiod;
                var totalmoney = v.totalmoney;
                $(rowObject).find("#id").html(id);
                $(rowObject).find("#typename").html(typename);
                $(rowObject).find("#money").html(money);
                $(rowObject).find("#vat").html(vat);
                $(rowObject).find("#chargeperiod").html(chargeperiod);
                $(rowObject).find("#totalmoney").html(totalmoney);
            }
            $.ajax({
                url: "http://localhost:9191/invoices/yearly",
                method: "get",
                dataType: "json",
                success: function (data) {
                    console.log(data)
                    $('#example tbody').find("tr:gt(0)").remove(); //remove all old rows except first one
                    $.each(data, function (i, v) {
                        if (i == 0) {
                            //setting the data in first row itself
                            setDataYearly($("#example tbody").find("tr").first(), v);
                            console.log(v)
                        } else {
                            //clonning the first row and setting data over it and then appending in tbody
                            var clonnedRow = $($("#example tbody").find("tr").first()).clone();
                            console.log(v)
                            setDataYearly(clonnedRow, v);
                            $("#example tbody").append(clonnedRow);
                        }
                    })
                }
            })

        }

        function getPeriod() {
            console.log("hdsfhdshf")
            function setDataPeriod(rowObject, v) {
                var id = v.id;
                var typename = v.typename;
                var money = v.money;
                var vat = v.vat;
                var chargeperiod = v.chargeperiod;
                var totalmoney = v.totalmoney;
                $(rowObject).find("#id").html(id);
                $(rowObject).find("#typename").html(typename);
                $(rowObject).find("#money").html(money);
                $(rowObject).find("#vat").html(vat);
                $(rowObject).find("#chargeperiod").html(chargeperiod);
                $(rowObject).find("#totalmoney").html(totalmoney);
            }

            var startPeriod =  $("#startPeriod").val();
            var endPeriod =  $("#endPeriod").val();
            $.ajax({
                url: `http://localhost:9191/invoices/searchDatePeriod?start=${startPeriod}&end=${endPeriod}`,
                method: "get",
                dataType: "json",
                success: function (data) {
                    console.log(data)
                    $('#example tbody').find("tr:gt(0)").remove(); //remove all old rows except first one
                    $.each(data, function (i, v) {
                        if (i == 0) {
                            //setting the data in first row itself
                            setDataPeriod($("#example tbody").find("tr").first(), v);
                            console.log(v)
                        } else {
                            //clonning the first row and setting data over it and then appending in tbody
                            var clonnedRow = $($("#example tbody").find("tr").first()).clone();
                            console.log(v)
                            setDataPeriod(clonnedRow, v);
                            $("#example tbody").append(clonnedRow);
                        }
                    })
                }
            })
        }



        function getall() {
            console.log("lmao")
            function setDataAll(rowObject, v) {
                var id = v.id;
                var typename = v.typename;
                var money = v.money;
                var vat = v.vat;
                var chargeperiod = v.chargeperiod;
                var totalmoney = v.totalmoney;
                $(rowObject).find("#id").html(id);
                $(rowObject).find("#typename").html(typename);
                $(rowObject).find("#money").html(money);
                $(rowObject).find("#vat").html(vat);
                $(rowObject).find("#chargeperiod").html(chargeperiod);
                $(rowObject).find("#totalmoney").html(totalmoney);
            }
            $.ajax({
                url: "http://localhost:9191/invoices/all",
                method: "get",
                dataType: "json",
                success: function (data) {
                    console.log(data)
                    $('#example tbody').find("tr:gt(0)").remove(); //remove all old rows except first one
                    $.each(data, function (i, v) {
                        if (i == 0) {
                            //setting the data in first row itself
                            setDataAll($("#example tbody").find("tr").first(), v);
                            console.log(v)
                        } else {
                            //clonning the first row and setting data over it and then appending in tbody
                            var clonnedRow = $($("#example tbody").find("tr").first()).clone();
                            console.log(v)
                            setDataAll(clonnedRow, v);
                            $("#example tbody").append(clonnedRow);
                        }
                    })
                }
            })

        }

        function updateInvoice(e) {
            console.log(e.value)
            localStorage.setItem("id", e.value)
            window.location.href = "/invoice_edit.html/"
        }


        function DeleteInvoice(e) {
            console.log(e.value)
            localStorage.setItem("id", e.value)
            var result = confirm("Are you sure that you want to DELETE this invoice?");
            if (result) {
                $.ajax({
                    url: "http://localhost:9191/invoices/delete/" + localStorage.getItem("id"),
                    method: "delete",
                    dataType: "json",
                    success: function (data) {
                    }

                })
            }
            window.location.reload();
        }






    </script>


</body>